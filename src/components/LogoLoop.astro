---
import type { SvgComponent } from "astro/types";

export interface Logo {
  Svg: SvgComponent;
  alt: string;
  label?: string;
  href?: string;
}

interface Props {
  logos: Logo[];
  speed?: number;
  direction?: 'left' | 'right';
  logoHeight?: number;
  gap?: number;
  pauseOnHover?: boolean;
  fadeOut?: boolean;
  class?: string;
}

const {
  logos,
  speed = 80,
  direction = 'left',
  logoHeight = 28,
  gap = 48,
  pauseOnHover = true,
  fadeOut = true,
  class: className,
} = Astro.props;

const COPIES = Math.max(8, Math.ceil(24 / logos.length));
---

<div
  class:list={["logo-loop relative overflow-x-hidden", className]}
  data-speed={speed}
  data-direction={direction}
  data-pause={pauseOnHover}
  style={`--ll-gap: ${gap}px; --ll-h: ${logoHeight}px;`}
  role="region"
  aria-label="Technologies used"
>
  {fadeOut && (
    <>
      <div
        aria-hidden="true"
        class="pointer-events-none absolute inset-y-0 left-0 z-10 w-[clamp(24px,10%,140px)] bg-linear-to-r from-background to-transparent"
      />
      <div
        aria-hidden="true"
        class="pointer-events-none absolute inset-y-0 right-0 z-10 w-[clamp(24px,10%,140px)] bg-linear-to-l from-background to-transparent"
      />
    </>
  )}

  <div class="logo-loop-track flex will-change-transform select-none">
    {Array.from({ length: COPIES }).map((_, copyIdx) => (
      <ul
        class:list={[
          "logo-loop-seq flex items-center shrink-0",
          copyIdx === 0 && "logo-loop-measure",
        ]}
        style={`gap: var(--ll-gap); padding-right: var(--ll-gap);`}
        role="list"
        aria-hidden={copyIdx > 0 ? "true" : undefined}
      >
        {logos.map((logo) => {
          const Svg = logo.Svg;
          return (
            <li class="flex-none" role="listitem">
              {logo.href ? (
                <a
                  href={logo.href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-flex items-center gap-2.5 no-underline opacity-50 hover:opacity-100 transition-opacity duration-200 focus-visible:outline focus-visible:outline-current focus-visible:outline-offset-2 rounded"
                >
                  <Svg
                    width={logoHeight}
                    height={logoHeight}
                    class="block object-contain pointer-events-none [-webkit-user-drag:none] shrink-0"
                    style={`height: var(--ll-h);`}
                    role="img"
                    aria-label={logo.alt}
                  />
                  {logo.label && (
                    <span class="text-base font-medium font-mono text-muted-foreground whitespace-nowrap">
                      {logo.label}
                    </span>
                  )}
                </a>
              ) : (
                <span class="inline-flex items-center gap-2.5 opacity-50">
                  <Svg
                    width={logoHeight}
                    height={logoHeight}
                    class="block object-contain pointer-events-none [-webkit-user-drag:none] shrink-0"
                    style={`height: var(--ll-h);`}
                    role="img"
                    aria-label={logo.alt}
                  />
                  {logo.label && (
                    <span class="text-base font-medium font-mono text-muted-foreground whitespace-nowrap">
                      {logo.label}
                    </span>
                  )}
                </span>
              )}
            </li>
          );
        })}
      </ul>
    ))}
  </div>
</div>

<script>
  import { initAllLogoLoops } from "@/scripts/logo-loop"
  initAllLogoLoops()
  document.addEventListener("astro:after-swap", () => initAllLogoLoops())
</script>
