---
interface Props {
  lang: string
  code?: string
}

const LANG_ICON_MAP: Record<string, string> = {
  typescript: "ts",
  javascript: "js",
  tsx: "ts",
  jsx: "js",
  bash: "bash",
  sh: "bash",
  shell: "bash",
  yml: "yaml",
  dockerfile: "dockerfile",
  docker: "dockerfile",
}

const LANG_LABEL_MAP: Record<string, string> = {
  js: "Javascript",
  ts: "TypeScript",
  tsx: "React (TS)",
  jsx: "React (JS)",
  sh: "Bash",
  yml: "YAML",
}

const { lang, code } = Astro.props

const label = lang || "text"
const iconLang = label === "text" ? "default" : (LANG_ICON_MAP[label] ?? label)
const iconPath = `/icons/lang/${iconLang}.svg`
const fallbackIcon = `/icons/lang/default.svg`
const displayLabel = LANG_LABEL_MAP[label] ?? label.charAt(0).toUpperCase() + label.slice(1)
const showLabel = label !== "text"
---

<div class="code-block group" data-language={label}>
  <div class="code-block-header">
    <div class="code-block-lang-info">
      <img src={iconPath} onerror={`this.src='${fallbackIcon}'`} width="18" height="18" alt="" class="code-block-lang-icon" />
      {showLabel && <span class="code-block-lang">{displayLabel}</span>}
    </div>
    <button class="copy-code-btn" type="button" data-copy-code="true" aria-label="Copy code">
      <span class="copy-code-icon copy-code-icon--copy" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </span>
      <span class="copy-code-icon copy-code-icon--check" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
      </span>
    </button>
  </div>
  {code ? <pre><code set:html={code} /></pre> : <pre><code><slot /></code></pre>}
</div>
